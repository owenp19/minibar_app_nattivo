<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChargeIt - Nattivo</title>

  <!-- google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton+SC&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

  <!-- remixicons -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">

  <!-- estilo css -->
  <link rel="stylesheet" href="/css/chargeit-minibar.css" />

  <!-- favicon -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/images/mujer_isleña.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>

<body>
  <div class="app-shell">
    <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

    <aside class="sidebar" aria-label="Navegación principal">
      <div class="sidebar-top">
        <div class="sidebar-logo-block">
          <img
            src="/images/Logo_Nattivo_v2.png"
            alt="Nattivo Collection Hotel"
            class="sidebar-logo"
          />
        </div>

        <div class="sidebar-user">
          <div class="sidebar-user-avatar" aria-hidden="true">
            <span id="user-initials"></span>
          </div>
          <div class="sidebar-user-info">
            <div class="sidebar-user-name" id="user-name">Operador minibar</div>
            <div class="sidebar-user-role">Nattivo Collection Hotel</div>
          </div>
        </div>

        <!-- Quick action (mobile-friendly) -->
        <div class="sidebar-quick">
          <a class="quick-btn" href="/app/salidas" aria-current="page">
            <i class="ri-flashlight-line"></i>
            <span>Nuevo consumo</span>
          </a>
        </div>

        <nav class="sidebar-nav">
          <a href="/app/salidas" class="nav-item nav-item-active" aria-current="page">
            <i class="ri-shopping-bag-3-line nav-icon"></i>
            <span class="nav-label">Consumo</span>
          </a>

          <a href="/unlock-folio.html" class="nav-item">
            <i class="ri-key-2-line nav-icon"></i>
            <span class="nav-label">Desbloqueo folio</span>
          </a>
        </nav>
      </div>

      <div class="sidebar-bottom">
        <form action="/api/auth/logout" method="POST" class="sidebar-nav">
          <button type="submit" class="nav-item nav-item-danger">
            <i class="ri-logout-box-line nav-icon"></i>
            <span class="nav-label">Cerrar sesión</span>
          </button>
        </form>
      </div>
    </aside>

    <main class="main-panel">
      <header class="main-header">
        <button class="menu-toggle" id="menu-toggle" aria-label="Abrir menú">
          <i class="ri-menu-line"></i>
        </button>

        <div class="main-header-title">
          <div class="breadcrumb">
            <i class="ri-home-5-line"></i>
            <span>Minibar</span>
            <i class="ri-arrow-right-s-line"></i>
            <strong>Consumo</strong>
          </div>

          <h1>Registro de consumo</h1>

          <p>
            Selecciona la habitación, marca los productos consumidos y envía el resumen a recepción por WhatsApp.
          </p>
        </div>
      </header>

      <!-- TOP STATS / UX helpers -->
      <section class="kpi-row" aria-label="Resumen">
        <div class="kpi-card">
          <div class="kpi-icon"><i class="ri-hotel-bed-line"></i></div>
          <div class="kpi-info">
            <div class="kpi-label">Habitación</div>
            <div class="kpi-value" id="kpi-room">—</div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon"><i class="ri-shopping-cart-2-line"></i></div>
          <div class="kpi-info">
            <div class="kpi-label">Items</div>
            <div class="kpi-value" id="kpi-items">0</div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon"><i class="ri-cash-line"></i></div>
          <div class="kpi-info">
            <div class="kpi-label">Total</div>
            <div class="kpi-value" id="kpi-total">$0</div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon"><i class="ri-time-line"></i></div>
          <div class="kpi-info">
            <div class="kpi-label">Última acción</div>
            <div class="kpi-value" id="kpi-time">—</div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="card-head">
          <div class="card-head-left">
            <h2 class="card-title">Herramienta de consumo</h2>
            <p class="card-subtitle">Registro rápido, claro y listo para enviar.</p>
          </div>

          <div class="card-head-actions">
            <button class="btn-secondary" type="button" id="clear-btn">
              <i class="ri-eraser-line"></i>
              Limpiar
            </button>
          </div>
        </div>

        <div class="form-grid">
          <!-- LEFT -->
          <div class="form-column">
            <div class="form-section">
              <label for="room-select">Habitación</label>
              <div class="select-row">
                <select id="room-select">
                  <option value="">Seleccione una habitación</option>
                </select>

                <button class="btn-ghost" type="button" id="refresh-rooms-btn" aria-label="Actualizar habitaciones">
                  <i class="ri-refresh-line"></i>
                </button>
              </div>

              <div class="helper-text">
                <i class="ri-information-line"></i>
                Tip: primero selecciona la habitación para habilitar el listado de productos.
              </div>
            </div>

            <div class="form-section">
              <div class="section-head">
                <label>Productos del minibar</label>

                <div class="section-tools">
                  <div class="search-box">
                    <i class="ri-search-line"></i>
                    <input id="product-search" type="text" placeholder="Buscar producto…" />
                  </div>

                  <button class="btn-ghost" type="button" id="select-all-btn" title="Seleccionar todo">
                    <i class="ri-check-double-line"></i>
                  </button>

                  <button class="btn-ghost" type="button" id="unselect-all-btn" title="Quitar selección">
                    <i class="ri-close-circle-line"></i>
                  </button>
                </div>
              </div>

              <div id="products-list" class="products-list" aria-label="Listado de productos"></div>

              <div class="helper-text">
                <i class="ri-shield-check-line"></i>
                El total se calcula automáticamente según cantidades seleccionadas.
              </div>
            </div>
          </div>

          <!-- RIGHT -->
          <div class="form-column form-column-side">
            <div class="report-card">
              <div class="report-head">
                <div>
                  <h2>Informe</h2>
                  <p class="summary-text-report">
                    Genera el PDF con consumos por rango de fechas.
                  </p>
                </div>
                <span class="pill">
                  <i class="ri-file-pdf-2-line"></i>
                  PDF
                </span>
              </div>

              <div class="report-filters">
                <div class="report-field">
                  <label for="report-from">Desde</label>
                  <input type="date" id="report-from" />
                </div>

                <div class="report-field">
                  <label for="report-to">Hasta</label>
                  <input type="date" id="report-to" />
                </div>

                <button id="download-report-btn" class="btn-report" type="button">
                  Descargar PDF
                </button>
              </div>

              <div id="report-status" class="report-status"></div>
            </div>

            <div class="form-section">
              <label for="note">Nota (opcional)</label>
              <textarea
                id="note"
                rows="3"
                placeholder="Ej: salida tardía, consumo extra, minibar incompleto, etc."
              ></textarea>
              <div class="helper-text">
                <i class="ri-chat-1-line"></i>
                Esta nota se incluirá en el resumen enviado a recepción.
              </div>
            </div>

            <div class="actions">
              <button id="submit-btn" class="btn-primary" type="button">
                <i class="ri-whatsapp-line"></i>
                Enviar a recepción
              </button>

              <div class="action-row">
                <button id="preview-btn" class="btn-secondary" type="button">
                  <i class="ri-eye-line"></i>
                  Vista previa
                </button>
                <button id="copy-btn" class="btn-secondary" type="button">
                  <i class="ri-file-copy-line"></i>
                  Copiar resumen
                </button>
              </div>

              <div id="status" class="status"></div>

              <div class="disclaimer">
                <i class="ri-lock-2-line"></i>
                Verifica habitación y total antes de enviar.
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Preview modal (optional UX) -->
      <div class="modal" id="preview-modal" aria-hidden="true">
        <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="preview-title">
          <div class="modal-head">
            <h3 id="preview-title">Vista previa del resumen</h3>
            <button class="btn-ghost" type="button" id="close-preview-btn" aria-label="Cerrar">
              <i class="ri-close-line"></i>
            </button>
          </div>
          <div class="modal-body">
            <pre class="preview-box" id="preview-content">—</pre>
          </div>
          <div class="modal-actions">
            <button class="btn-secondary" type="button" id="preview-copy-btn">
              <i class="ri-file-copy-line"></i>
              Copiar
            </button>
            <button class="btn-primary" type="button" id="preview-send-btn">
              <i class="ri-whatsapp-line"></i>
              Enviar
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="/js/chargeit-minibar.js" defer></script>

  <!-- Minimal JS for layout interactions (no rompe tu JS actual) -->
  <script>
    // Sidebar toggle
    const toggleBtn = document.getElementById('menu-toggle');
    const sidebar = document.querySelector('.sidebar');
    const backdrop = document.getElementById('sidebar-backdrop');

    if (toggleBtn && sidebar && backdrop) {
      toggleBtn.addEventListener('click', () => {
        sidebar.classList.toggle('sidebar-open');
        backdrop.classList.toggle('backdrop-visible');
      });

      backdrop.addEventListener('click', () => {
        sidebar.classList.remove('sidebar-open');
        backdrop.classList.remove('backdrop-visible');
      });
    }

    // Preview modal (UI only)
    const modal = document.getElementById('preview-modal');
    const openPreview = document.getElementById('preview-btn');
    const closePreview = document.getElementById('close-preview-btn');
    const previewContent = document.getElementById('preview-content');

    function openModal() {
      if (!modal) return;
      modal.classList.add('visible');
      modal.setAttribute('aria-hidden', 'false');
    }

    function closeModal() {
      if (!modal) return;
      modal.classList.remove('visible');
      modal.setAttribute('aria-hidden', 'true');
    }

    if (openPreview) {
      openPreview.addEventListener('click', () => {
        // Si tu JS ya arma el resumen, aquí solo muestras algo por defecto.
        // Puedes reemplazarlo luego desde /js/salidas-herramienta.js
        if (previewContent && previewContent.textContent.trim() === '—') {
          previewContent.textContent = 'Selecciona una habitación y productos para generar el resumen.';
        }
        openModal();
      });
    }
    if (closePreview) closePreview.addEventListener('click', closeModal);
    if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

    // Botones auxiliares (placeholder)
    const clearBtn = document.getElementById('clear-btn');
    if (clearBtn) clearBtn.addEventListener('click', () => {
      const room = document.getElementById('room-select');
      const note = document.getElementById('note');
      const search = document.getElementById('product-search');
      if (room) room.value = '';
      if (note) note.value = '';
      if (search) search.value = '';
      // No toca tu lógica; tu JS puede escuchar cambios si lo necesitas.
    });
  </script>
</body>
</html>
